
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://kannibalox.github.io/pyrosimple/advanced/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.12">
    
    
      
        <title>Advanced Features - pyrosimple</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i%7CInconsolata:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Lato";--md-code-font:"Inconsolata"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-rtcontrol" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="pyrosimple" class="md-header__button md-logo" aria-label="pyrosimple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="m505.2 324.8-47.73-68.78 47.75-68.81c7.359-10.62 8.797-24.12 3.844-36.06-4.969-11.94-15.52-20.44-28.22-22.72l-82.39-14.88-14.89-82.41c-2.281-12.72-10.76-23.25-22.69-28.22-11.97-4.936-25.42-3.498-36.12 3.844L256 54.49 187.2 6.709c-10.7-7.31-24.1-8.748-36.1-3.813-11.92 4.971-20.4 15.5-22.7 28.19l-14.89 82.44L31.15 128.4c-12.73 2.3-23.296 10.8-28.25 22.8-4.951 11.9-3.5 25.4 3.875 36l47.73 68.78-47.75 68.81c-7.359 10.62-8.795 24.12-3.844 36.06 4.969 11.94 15.52 20.44 28.22 22.72l82.39 14.88 14.89 82.41c2.297 12.72 10.78 23.25 22.7 28.22 11.95 4.906 25.44 3.531 36.09-3.844L256 457.5l68.83 47.78c6.47 4.42 13.97 6.72 21.47 6.72 4.906 0 9.859-.969 14.56-2.906 11.92-4.969 20.4-15.5 22.7-28.19l14.89-82.44 82.37-14.88c12.73-2.281 23.3-10.78 28.25-22.75 5.03-11.934 3.53-25.434-3.87-36.034zm-48.4 14.4-99.61 18-18 99.63L256 399.1l-83.2 57.7-18-99.63-99.61-18 57.71-84.07-57.67-82.3 99.61-18 18-99.63L256 112.9l83.15-57.75 18.02 99.66 99.61 18-57.68 82.29 57.7 84.1zM256 143.1c-61.85 0-111.1 50.14-111.1 111.1 0 61.85 50.15 111.1 111.1 111.1s111.1-50.14 111.1-111.1c0-60.1-49.3-111.1-111.1-111.1zm0 176c-35.28 0-63.99-28.71-63.99-63.99S220.7 192 256 192s63.99 28.71 63.99 63.1-28.69 64-63.99 64z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pyrosimple
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Advanced Features
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent=""  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
          
            <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/kannibalox/pyrosimple" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../quickstart/" class="md-tabs__link">
      Quick Start
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../usage-rtxmlrpc/" class="md-tabs__link">
        User Guide
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../changing-announce/" class="md-tabs__link">
        How-tos
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../configuration/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../rtorrent-config/" class="md-tabs__link">
        Advanced
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="pyrosimple" class="md-nav__button md-logo" aria-label="pyrosimple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="m505.2 324.8-47.73-68.78 47.75-68.81c7.359-10.62 8.797-24.12 3.844-36.06-4.969-11.94-15.52-20.44-28.22-22.72l-82.39-14.88-14.89-82.41c-2.281-12.72-10.76-23.25-22.69-28.22-11.97-4.936-25.42-3.498-36.12 3.844L256 54.49 187.2 6.709c-10.7-7.31-24.1-8.748-36.1-3.813-11.92 4.971-20.4 15.5-22.7 28.19l-14.89 82.44L31.15 128.4c-12.73 2.3-23.296 10.8-28.25 22.8-4.951 11.9-3.5 25.4 3.875 36l47.73 68.78-47.75 68.81c-7.359 10.62-8.795 24.12-3.844 36.06 4.969 11.94 15.52 20.44 28.22 22.72l82.39 14.88 14.89 82.41c2.297 12.72 10.78 23.25 22.7 28.22 11.95 4.906 25.44 3.531 36.09-3.844L256 457.5l68.83 47.78c6.47 4.42 13.97 6.72 21.47 6.72 4.906 0 9.859-.969 14.56-2.906 11.92-4.969 20.4-15.5 22.7-28.19l14.89-82.44 82.37-14.88c12.73-2.281 23.3-10.78 28.25-22.75 5.03-11.934 3.53-25.434-3.87-36.034zm-48.4 14.4-99.61 18-18 99.63L256 399.1l-83.2 57.7-18-99.63-99.61-18 57.71-84.07-57.67-82.3 99.61-18 18-99.63L256 112.9l83.15-57.75 18.02 99.66 99.61 18-57.68 82.29 57.7 84.1zM256 143.1c-61.85 0-111.1 50.14-111.1 111.1 0 61.85 50.15 111.1 111.1 111.1s111.1-50.14 111.1-111.1c0-60.1-49.3-111.1-111.1-111.1zm0 176c-35.28 0-63.99-28.71-63.99-63.99S220.7 192 256 192s63.99 28.71 63.99 63.1-28.69 64-63.99 64z"/></svg>

    </a>
    pyrosimple
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kannibalox/pyrosimple" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usage-rtxmlrpc/" class="md-nav__link">
        rtxmlrpc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usage-rtcontrol/" class="md-nav__link">
        rtcontrol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usage-pyrotorque/" class="md-nav__link">
        pyrotorque
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usage-tor/" class="md-nav__link">
        mktor/lstor/chtor
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          How-tos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          How-tos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../changing-announce/" class="md-nav__link">
        Changing announce URLs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../conky/" class="md-nav__link">
        Integrate with Conky
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../maintenance-tasks/" class="md-nav__link">
        General maintenance tasks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pyrotorque-tutorial/" class="md-nav__link">
        Pyrotorque tutorial
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pyrotorque-jobs/" class="md-nav__link">
        Torque Jobs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rtorrent-config/" class="md-nav__link">
        rTorrent Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../experimental/" class="md-nav__link">
        Experimental Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tips/" class="md-nav__link">
        Tips & Tricks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../migrate/" class="md-nav__link">
        Migrating from pyrocore
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom-code/" class="md-nav__link">
        Custom Code
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using these features requires some knowledge in the area of Linux,
Bash, and Python, but they enable you to customize your setup even
further and handle very specific use-cases.</p>
</div>
<h1 id="advanced-rtcontrol">Advanced 'rtcontrol'</h1>
<h2 id="executing-os-commands">Executing OS commands</h2>
<p>The <code>--call</code> and <code>--spawn</code> options can be used to call an OS level
command and feed it with data from the selected items. The argument to
both options is a template, i.e. you can have things like
<code>{{item.hash}}</code> in them.</p>
<p>When using <code>--call</code>, the command is passed to the shell for parsing --
with obvious implications regarding the quoting of arguments, thus
<code>--call</code> only makes sense if you need I/O redirection or similar shell
features.</p>
<p>In contrast, the <code>--spawn</code> option splits its argument list according to
shell rules <em>before</em> expanding the template placeholders, and then calls
the resulting sequence of command name and arguments directly. Consider
<code>--spawn 'echo "name: {{i.name}}"'</code> vs.
<code>--spawn 'echo name: {{i.name}}'</code> -- the first form passes one
argument to <code>/bin/echo</code>, the second form two arguments. Note that in
both cases, spaces or shell meta characters contained in the item name
are of no relevance, since the argument list is split according to the
template, <em>not</em> its expanded value.</p>
<p>To list all the fields available in the first five items, try this
command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>rtcontrol<span class="w"> </span>//<span class="w"> </span>-/5<span class="w"> </span>--spawn<span class="w"> </span><span class="s2">&quot;echo -e &#39;\\n&#39;{{i}}&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-re<span class="w"> </span><span class="s1">&#39;s/, /,\n    /g&#39;</span>
</code></pre></div>
<p>Unlike <code>--call</code>, where you can use shell syntax to call several
commands, <code>--spawn</code> can be passed several times for executing a sequence
of commands. If any called command fails, the <code>rtcontrol</code> call is
aborted with an error.</p>
<h3 id="copy-session-metafiles-by-category">Copy Session Metafiles by Category</h3>
<p>Here's a practical example for using <code>--spawn</code>, it copies all your
loaded metafiles from the session directory into a folder structure
categorized by the <em>ruTorrent</em> label. Unlabelled items go to the
<code>_NOLABEL</code> folder.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;/tmp/metafiles&quot;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>rtcontrol<span class="w"> </span>//<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span>--spawn<span class="w"> </span><span class="s2">&quot;mkdir -p \&quot;</span><span class="nv">$target</span><span class="s2">/&quot;</span><span class="s1">&#39;{{i.fetch(1) or \&quot;_NOLABEL\&quot;}}&quot;&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span>--spawn<span class="w"> </span><span class="s1">&#39;cp {{i.sessionfile}} &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="s1">&#39;/{{item.fetch(1) or \&quot;_NOLABEL\&quot;}}/{{item.name}}-{{item.hash[:7]}}.torrent&quot;&#39;</span>
</code></pre></div>
<p>The copied metafiles themselves are renamed to the contained name of the
item's data, plus a small part of the infohash to make these names
unique.</p>
<p>Replace the <code>i.fetch(1)</code> by <code>i.‹fieldname›</code> to categorize by other
values, e.g. <code>i.alias</code> for 'by tracker'.</p>
<h2 id="executing-xmlrpc-commands-rtcontrol-exec">Executing XMLRPC commands {#rtcontrol-exec}</h2>
<p>If you want to apply some custom XMLRPC commands against a set of
download items, the <code>--exec</code> option of <code>rtcontrol</code> allows you to do
that. For global commands not referring to specific items, see the next
section about the <code>rtxmlrpc</code> tool. Read through the following examples
to understand how <code>--exec</code> works, features are explained as they are
used there. Also make sure you understand basic things like
<code>output-templates</code>{.interpreted-text role="ref"} beforehand, it's
assumed here that you do.</p>
<h3 id="repairing-stuck-items">Repairing Stuck Items</h3>
<p>Let's start with an easy example of using <code>--exec</code>, where no templating
is needed:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>rtcontrol<span class="w"> </span>--exec<span class="w"> </span><span class="s1">&#39;stop= ; close= ; f.multicall=,f.set_create_queued=0,f.set_resize_queued=0 ; check_hash=&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">          </span>--from<span class="w"> </span>stopped<span class="w"> </span>//<span class="w"> </span>-/1
</code></pre></div>
<p>This command simulates pressing <code>^K^E^R</code> in the curses UI (which cleans
the state of stuck / damaged items), and as written above only affects
the first stopped item.</p>
<p>Use different filter arguments after <code>--exec</code> to select other items.
Afterwards, use <code>--start</code> to start these items again.</p>
<h3 id="manually-triggering-events">Manually Triggering Events</h3>
<p>Since rTorrent events are merely multi-call commands, you can trigger
them manually by calling them on selected items. This calls
<code>event.download.finished</code> (again) on complete items loaded
in the last 10 minutes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>rtcontrol<span class="w"> </span>--exec<span class="w"> </span><span class="s2">&quot;event.download.finished=&quot;</span><span class="w"> </span><span class="s1">&#39;loaded&lt;10m&#39;</span><span class="w"> </span><span class="nv">is_complete</span><span class="o">=</span>y
</code></pre></div>
<p>The <code>:</code> prefix prevents <code>rtcontrol</code> from assuming this is a <code>d.</code> item
command.</p>
<p>Make sure that the registered handlers do not have adverse effects when
called repeatedly, i.e. know what you're doing. The handlers for an
event can be listed like so:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>rtxmlrpc<span class="w"> </span>--repr<span class="w"> </span>method.get<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>event.download.finished
</code></pre></div>
<h3 id="relocating-download-data">Relocating Download Data</h3>
<p>The most simple variant of changing the download path is setting a new
fixed location for all selected items, as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>rtcontrol<span class="w"> </span>--exec<span class="w"> </span><span class="s1">&#39;d.directory_base.set=&quot;/mnt/data/new/path&quot;&#39;</span><span class="w"> </span><span class="nv">directory</span><span class="o">=</span>/mnt/data/old/path
</code></pre></div>
<p>This replaces the location of items stored at <code>/mnt/data/old/path</code> with
a new path. But to be really useful, we'd want to shift <em>any</em> path
under a given base directory to a new location -- the next command does
this by using templating and calculating the new path based on the old
one:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>rtcontrol<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span>--exec<span class="w"> </span><span class="s1">&#39;d.directory_base.set=&quot;{{item.directory|subst(&quot;^/mnt/data/&quot;,&quot;/var/data/&quot;)}}&quot; ; &gt;d.directory=&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span>d.directory<span class="o">=</span>/mnt/data/<span class="se">\*</span>
</code></pre></div>
<p>This selects any item stored under <code>/mnt/data</code> and relocates it to the
new base directory <code>/var/data</code>. Fields of an item can be used via a
<code>item.‹field-name›</code> reference. Adding <code>&gt;d.directory=</code> prints the new
location to the console -- a semicolon with spaces on both sides
delimits several commands, and the <code>&gt;</code> prints the result of a XMLRPC
command.</p>
<p>The <code>move-data</code>{.interpreted-text role="ref"} section has more on how to
also move the data on disk, in addition to changing the location in
rTorrent's session as shown here.</p>
<h3 id="making-shared-data-paths-unique">Making Shared Data Paths Unique</h3>
<p>Another example regarding data paths is this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>rtcontrol<span class="w"> </span>--from<span class="w"> </span>stopped<span class="w"> </span>//<span class="w"> </span>--exec<span class="w"> </span><span class="s1">&#39;directory.set={{item.directory}}-{{item.hash}}&#39;</span>
</code></pre></div>
<p>That command ensures that items that would download into the same path
get a unique name by appending the info hash, and assumes those items
weren't started yet (i.e. added via <code>load.normal</code>).</p>
<h3 id="changing-announce-urls-in-bulk">Changing Announce URLs in Bulk</h3>
<p>The next example replaces an active announce URL with a new one, which
is necessary after a domain or passkey change. Compared to other methods
like using <code>sed</code> on the files in your session directory, this does not
require a client restart, and is also safer (the <code>sed</code> approach can
easily make your session files unusable). This disables all old announce
URLs in group 0 using a <code>t.multicall</code>, and then adds a new one:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>rtcontrol<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span>--exec<span class="w"> </span><span class="s1">&#39;t.multicall=0,t.disable= ; d.tracker.insert=0,&quot;http://new.example.com/announce&quot; ; d.save_full_session=&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="s2">&quot;tracker=http://old.example.com/announce&quot;</span>
</code></pre></div>
<p>The <code>tracker.insert</code> also shows that arguments to commands can be
quoted.</p>
<h2 id="using-templates-as-filter-values">Using Templates as Filter Values</h2>
<p>As mentioned in <code>filter-conditions</code>, you
can compare a string field to a template. This can be a brain twister,
so just look at the following example, which replaces any download path
in an item by the real storage path, but only if they differ.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># List any differences</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>rtcontrol<span class="w"> </span><span class="nv">path</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="w"> </span><span class="nv">is_multi_file</span><span class="o">=</span>y<span class="w"> </span><span class="s1">&#39;directory!={{d.realpath}}&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span>-qo<span class="w"> </span>directory,realpath
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>rtcontrol<span class="w"> </span><span class="nv">path</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="w"> </span><span class="nv">is_multi_file</span><span class="o">=</span>n<span class="w"> </span><span class="s1">&#39;directory!={{d.realpath | pathdir}}&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span>-qo<span class="w"> </span>directory,realpath.pathdir
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="c1"># Fix any differences (i.e. resolve all symlinks for good)</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>rtcontrol<span class="w"> </span><span class="nv">path</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="w"> </span><span class="nv">is_multi_file</span><span class="o">=</span>y<span class="w"> </span><span class="s1">&#39;directory!={{d.realpath}}&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span>--exec<span class="w"> </span><span class="s1">&#39;directory_base.set={{item.realpath}}&#39;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>rtcontrol<span class="w"> </span><span class="nv">path</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="w"> </span><span class="nv">is_multi_file</span><span class="o">=</span>n<span class="w"> </span><span class="s1">&#39;directory!={{d.realpath | pathdir}}&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">    </span>--exec<span class="w"> </span><span class="s1">&#39;directory.set={{item.realpath | pathdir}}&#39;</span>
</code></pre></div>
<p>As so often, 'multi' and 'single' items need a slighty different
treatment.</p>
<p>Note that <code>[</code> characters are escaped to <code>[[]</code> after the template
expansion, so that things like <code>[2017]</code> in a filename do not lead to
unexpected results. <code>*</code> and <code>?</code> though are kept intact and are used for
glob matching as normal, because they match their own literal form if
they appear in the field value (on the right-hand side).</p>
<h1 id="using-rtxmlrpc">Using 'rtxmlrpc'</h1>
<h2 id="querying-system-information">Querying system information</h2>
<p>The <code>rtuptime</code> script shows you essential information about your
<em>rTorrent</em> instance:</p>
<p>::: {.literalinclude language="shell"}
examples/rtuptime
:::</p>
<p>When called, it prints something like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="gp">$ </span>rtuptime
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="go">rTorrent 0.9.6/0.13.6, up 189:00:28 [315 loaded; U: 177.292 GiB; S: 891.781 GiB],</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="go">D: 27.3 GB @ 0.0 KB/s of 520.0 KB/s, U: 36.8 MB @ 0.0 KB/s of 52.0 KB/s</span>
</code></pre></div>
<p>And yes, doing the same in a <code>Python script &lt;scripts&gt;</code>{.interpreted-text
role="ref"} would be much more CPU efficient. ;)</p>
<p>If you connect via <code>network.scgi.open_port</code>, touch a file in <code>/tmp</code> in
your startup script and use that for uptime checking.</p>
<h2 id="load-metafile-with-a-specific-data-path">Load Metafile with a Specific Data Path</h2>
<p>The following shows how to load a metafile from any path in <code>$metafile</code>,
not only a watch directory, with the data downloaded to <code>$data_dir</code> by
adding a <code>d.directory_base.set</code> on-load command. You might need to
change that to <code>d.directory.set</code> depending on your exact use-case.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>rtxmlrpc<span class="w"> </span>-q<span class="w"> </span>load.normal<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$metafile</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="s2">&quot;d.directory_base.set=\&quot;</span><span class="nv">$data_dir</span><span class="s2">\&quot;&quot;</span><span class="w"> </span><span class="s2">&quot;d.priority.set=1&quot;</span>
</code></pre></div>
<p>Use <code>load.start</code> to start that item immediately. If the metafile has
fast-resume information and the data is already there, no extra hashing
is done.</p>
<p>And just to show you can add more on-load commands, the priority of the
new item is set to <code>low</code>. Other common on-load commands are those that
set custom values, e.g. the <em>ruTorrent</em> label.</p>
<h2 id="general-maintenance-tasks">General maintenance tasks</h2>
<p>Here are some commands that can help with managing your rTorrent
instance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Flush ALL session data NOW, use this before you make a backup of your session directory</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>rtxmlrpc<span class="w"> </span>session.save
</code></pre></div>
<h2 id="setting-and-checking-throttles">Setting and checking throttles</h2>
<p>To set the speed of the <code>slow</code> throttle, and then check your new limit
and print the current download rate, use:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="gp">$ </span>rtxmlrpc<span class="w"> </span>throttle.down<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>slow<span class="w"> </span><span class="m">120</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="go">0</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="gp">$ </span>rtxmlrpc<span class="w"> </span>throttle.down.max<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>slow
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="go">122880</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="gp">$ </span>rtxmlrpc<span class="w"> </span>throttle.down.rate<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>slow
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="go">0</span>
</code></pre></div>
<p>Note that the speed is specified in KiB/s as a string when setting it
but returned in bytes/s as an integer on queries.</p>
<p>The following script makes this available in an easy usable form, e.g.
<code>throttle slow 42</code> -- it also shows the current rate and settings of all
defined throttles when called without arguments:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="ch">#! /bin/bash</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1"># Set speed of named throttle</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1">#</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c1"># CONFIGURATION</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1">#</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="nv">throttle_name</span><span class="o">=</span><span class="s2">&quot;seed&quot;</span><span class="w"> </span><span class="c1"># default name</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="nv">unit</span><span class="o">=</span><span class="m">1024</span><span class="w"> </span><span class="c1"># KiB/s</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="c1">#</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="c1"># HERE BE DRAGONS!</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="c1">#</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="nv">down</span><span class="o">=</span><span class="nb">false</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-d&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">    </span><span class="nv">down</span><span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">    </span><span class="nb">shift</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="k">fi</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="m">0</span>-9<span class="k">)</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">    </span><span class="c1"># Non-numeric $1 is a name</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">    </span><span class="nv">throttle_name</span><span class="o">=</span><span class="nv">$1</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="w">    </span><span class="nb">shift</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="k">fi</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;Usage: </span><span class="si">${</span><span class="nv">0</span><span class="p">/</span><span class="nv">$HOME</span><span class="p">/~</span><span class="si">}</span><span class="s2"> [-d] [&lt;throttle-name=</span><span class="nv">$throttle_name</span><span class="s2">&gt;] &lt;rate&gt;&quot;</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w">    </span><span class="nv">rtorrent_rc</span><span class="o">=</span>~/.rtorrent.rc
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w">    </span><span class="nb">test</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$rtorrent_rc</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">rtorrent_rc</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>system.get_cwd<span class="k">)</span><span class="s2">/rtorrent.rc&quot;</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$rtorrent_rc</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="w">        </span><span class="nv">throttles</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>egrep<span class="w"> </span><span class="s1">&#39;^throttle[._](up|down)&#39;</span><span class="w"> </span><span class="nv">$rtorrent_rc</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>._<span class="o">=</span>,<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f3<span class="w"> </span>-d<span class="s2">&quot; &quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;CURRENT THROTTLE SETTINGS&quot;</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span>throttle<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$throttles</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$throttle</span><span class="s2">\t&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="w">                </span><span class="s2">&quot;U: </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>to_kb<span class="w"> </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>throttle.up.rate<span class="w"> </span><span class="nv">$throttle</span><span class="k">))</span><span class="s2"> /&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="w">                </span><span class="s2">&quot;</span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>to_kb<span class="w"> </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>throttle.up.max<span class="w"> </span><span class="nv">$throttle</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/^-1$/0/&#39;</span><span class="k">))</span><span class="s2"> KiB/s\t&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="w">                </span><span class="s2">&quot;D: </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>to_kb<span class="w"> </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>throttle.down.rate<span class="w"> </span><span class="nv">$throttle</span><span class="k">))</span><span class="s2"> /&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="w">                </span><span class="s2">&quot;</span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>to_kb<span class="w"> </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>throttle.down.max<span class="w"> </span><span class="nv">$throttle</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/^-1$/0/&#39;</span><span class="k">))</span><span class="s2"> KiB/s&quot;</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="w">        </span><span class="k">done</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">2</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="k">fi</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a><span class="nv">rate</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">$unit</span><span class="w"> </span><span class="k">))</span>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a><span class="c1"># Set chosen bandwidth</span>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a><span class="k">if</span><span class="w"> </span><span class="nv">$down</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>throttle.down.max<span class="w"> </span><span class="nv">$throttle_name</span><span class="k">)</span><span class="w"> </span>-ne<span class="w"> </span><span class="nv">$rate</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a><span class="w">        </span>rtxmlrpc<span class="w"> </span>-q<span class="w"> </span>throttle.down<span class="w"> </span><span class="nv">$throttle_name</span><span class="w"> </span><span class="k">$((</span><span class="w"> </span><span class="nv">$rate</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="k">))</span>
<a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Throttle &#39;</span><span class="nv">$throttle_name</span><span class="s2">&#39; download rate changed to&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a><span class="w">             </span><span class="s2">&quot;</span><span class="k">$((</span><span class="w"> </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>throttle.down.max<span class="w"> </span><span class="nv">$throttle_name</span><span class="k">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="k">))</span><span class="s2"> KiB/s&quot;</span>
<a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="k">else</span>
<a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>throttle.up.max<span class="w"> </span><span class="nv">$throttle_name</span><span class="k">)</span><span class="w"> </span>-ne<span class="w"> </span><span class="nv">$rate</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a><span class="w">        </span>rtxmlrpc<span class="w"> </span>-q<span class="w"> </span>throttle.up<span class="w"> </span><span class="nv">$throttle_name</span><span class="w"> </span><span class="k">$((</span><span class="w"> </span><span class="nv">$rate</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="k">))</span>
<a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Throttle &#39;</span><span class="nv">$throttle_name</span><span class="s2">&#39; upload rate changed to&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a><span class="w">             </span><span class="s2">&quot;</span><span class="k">$((</span><span class="w"> </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>throttle.up.max<span class="w"> </span><span class="nv">$throttle_name</span><span class="k">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="k">))</span><span class="s2"> KiB/s&quot;</span>
<a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a><span class="k">fi</span>
</code></pre></div>
<h2 id="global-throttling-when-other-computers-are-up">Global throttling when other computers are up</h2>
<p>If you want to be loved by your house-mates, try this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="ch">#! /bin/bash</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="c1"># Throttle bittorrent when certain hosts are up</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1">#</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="c1"># CONFIGURATION</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="c1">#</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="nv">hosts_to_check</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">mom</span><span class="p"> dad</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="nv">full_up</span><span class="o">=</span><span class="m">62</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="nv">full_down</span><span class="o">=</span><span class="m">620</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="nv">nice_up</span><span class="o">=</span><span class="m">42</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="nv">nice_down</span><span class="o">=</span><span class="m">123</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="nv">unit</span><span class="o">=</span><span class="m">1024</span><span class="w"> </span><span class="c1"># KiB/s</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="c1">#</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="c1"># HERE BE DRAGONS!</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="c1">#</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="c1"># Check if any prioritized hosts are up</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="nv">up</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="nv">$full_up</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">$unit</span><span class="w"> </span><span class="k">))</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="nv">down</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="nv">$full_down</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">$unit</span><span class="w"> </span><span class="k">))</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="nv">hosts</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="k">for</span><span class="w"> </span>host<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$hosts_to_check</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>ping<span class="w"> </span>-c1<span class="w"> </span><span class="nv">$host</span><span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">        </span><span class="nv">up</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="nv">$nice_up</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">$unit</span><span class="w"> </span><span class="k">))</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">        </span><span class="nv">down</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="nv">$nice_down</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">$unit</span><span class="w"> </span><span class="k">))</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">        </span><span class="nv">hosts</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$hosts</span><span class="s2"> </span><span class="nv">$host</span><span class="s2">&quot;</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="k">done</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="nv">reason</span><span class="o">=</span><span class="s2">&quot;at full throttle&quot;</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="nb">test</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$hosts</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">reason</span><span class="o">=</span><span class="s2">&quot;for</span><span class="nv">$hosts</span><span class="s2">&quot;</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="c1"># Set chosen bandwidth</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>throttle.global_up.max_rate<span class="k">)</span><span class="w"> </span>-ne<span class="w"> </span><span class="nv">$up</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Setting upload rate to </span><span class="k">$((</span><span class="w"> </span><span class="nv">$up</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="k">))</span><span class="s2"> KiB/s </span><span class="nv">$reason</span><span class="s2">&quot;</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="w">    </span>rtxmlrpc<span class="w"> </span>-q<span class="w"> </span>throttle.global_up.max_rate.set_kb<span class="w"> </span><span class="k">$((</span><span class="w"> </span><span class="nv">$up</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="k">))</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="k">fi</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">$(</span>rtxmlrpc<span class="w"> </span>throttle.global_down.max_rate<span class="k">)</span><span class="w"> </span>-ne<span class="w"> </span><span class="nv">$down</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Setting download rate to </span><span class="k">$((</span><span class="w"> </span><span class="nv">$down</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="k">))</span><span class="s2"> KiB/s </span><span class="nv">$reason</span><span class="s2">&quot;</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="w">    </span>rtxmlrpc<span class="w"> </span>-q<span class="w"> </span>throttle.global_down.max_rate.set_kb<span class="w"> </span><span class="k">$((</span><span class="w"> </span><span class="nv">$down</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="k">))</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="k">fi</span>
</code></pre></div>
<p>Add it to your crontab and run it every few minutes.</p>
<h2 id="throttling-rtorrent-for-a-limited-time">Throttling rTorrent for a limited time</h2>
<p>If you want to slow down <em>rTorrent</em> to use your available bandwidth on
foreground tasks like browsing, but usually forget to return the
throttle settings back to normal, then you can use the provided
<a href="">rt-backseat</a> script. It will register a job via <code>at</code>, so that command
must be installed on the machine for it to work. The default throttle
speed and timeout can be set at the top of the script.</p>
<p>::: {.literalinclude language="bash"}
examples/rt-backseat
:::</p>
<p>::: {#rt-backseat}</p>
<blockquote>
<p><a href="https://github.com/pyroscope/pyrocore/blob/master/docs/examples/rt-backseat">https://github.com/pyroscope/pyrocore/blob/master/docs/examples/rt-backseat</a>
:::</p>
</blockquote>
<h1 id="rtorrent-queue-manager-queuemanager">rTorrent Queue Manager {#QueueManager}</h1>
<h2 id="introduction">Introduction</h2>
<p>The <code>pyrotorque</code> command is a daemon that handles background jobs. At
first, it was just a flexible torrent queue manager for starting items
one at a time (thus the name <code>pyro-tor-que</code>), but it can now manage any
job that does some background processing for rTorrent, including custom
ones that you can add yourself.</p>
<p>It runs in the background parallel to rTorrent and has its own scheduler
to run automation jobs similar to rTorrent's <code>schedule</code> command --- one
of the jobs does start stopped items in a controlled fashion, that is
the queue manager part.</p>
<p>Besides the queue manager, the most important job type is <code>TreeWatch</code>.
It reacts to file system events (via <code>inotify</code>) to load new metafiles on
the spot, if you add the necessary configuration and activate it. This
way you have no delays at all, and no polling of watch directories in
short intervals, most often with no tangible result and just wasted CPU
cycles. Also, you can place the metafiles in arbitrary folders and
sub-folders, with just one configuration entry for the root folder to
watch. The queue is able to start items loaded via <code>inotify</code>, i.e. both
jobs can work together.</p>
<p>If you want to know about the gory details of the machinery behind this,
read <code>torque-custom-jobs</code>{.interpreted-text role="ref"}.</p>
<h2 id="initial-setup">Initial Setup</h2>
<p>Before you start configuring the daemon, you have to install some
additional Python dependencies it needs to do its work, also depending
on what jobs you activate in your configuration. The following is how to
install the <em>full</em> set of dependencies:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>~/.local/pyroscope/bin/pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>~/.local/pyroscope/requirements-torque.txt
</code></pre></div>
<p>Watch out for any errors, since this installs several Python extensions
that <em>might</em> need some <code>*-dev</code> OS packages available that you don't
have on your machine.</p>
<p>The <code>pyrotorque</code> queue manager daemon relies on certain additions to
<code>rtorrent.rc</code>, these are included in the standard <code>pyrocore</code> includes
that you added when you followed the <code>setup</code>{.interpreted-text
role="doc"}. If for whatever reason you need to add these manually, the
file <code>~/.pyroscope/rtorrent.d/torque.rc.default</code> holds these settings.</p>
<p>The daemon itself is configured by an additional configuration file
<code>~/.pyroscope/torque.ini</code> containing the <code>[TORQUE]</code> section. Most
settings are already covered in <code>torque.ini.default</code>, including some
short explanation what each setting does. The next section shows how to
customize these defaults.</p>
<h2 id="configuration-torque-config">Configuration {#torque-config}</h2>
<h3 id="minimal-example">Minimal Example</h3>
<p>The following is a <strong>minimal</strong> <code>~/.pyroscope/torque.ini</code> <strong>configuration
example</strong>, only changing a few values from the defaults to demonstrate
key features:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># &quot;pyrotorque&quot; configuration file</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1">#</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1"># For details, see https://pyrocore.readthedocs.io/en/latest/advanced.html#torque-config</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1">#</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="k">[TORQUE]</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="c1"># Queue manager</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="na">job.queue.active</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="na">job.queue.schedule</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s">second=*/5</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="na">job.queue.intermission</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s">60</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="na">job.queue.downloading_max</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s">3</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="na">job.queue.startable</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">is_ignored=0 message= prio&gt;0</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">        </span><span class="k">[ prio&gt;2 OR [ NOT [ traits=audio kind_25=jpg,png,tif,bmp ] ] ]</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="na">job.queue.downloading</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">[ prio&gt;1 [ down&gt;3 OR started&lt;2i ] ]</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="c1"># Tree watch (works together with the queue)</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="na">job.treewatch.active</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="na">job.treewatch.load_mode</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">start</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="na">job.treewatch.queued</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="na">job.treewatch.path</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s">/var/torrent/watch</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="na">job.treewatch.cmd.nfo</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">f.multicall=*.nfo,f.priority.set=2</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="na">job.treewatch.cmd.jpg</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">f.multicall=*.jpg,f.priority.set=2</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="na">job.treewatch.cmd.png</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">f.multicall=*.png,f.priority.set=2</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="na">job.treewatch.cmd.tif</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">f.multicall=*.tif,f.priority.set=0</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="na">job.treewatch.cmd.target</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">{{</span><span class="c1"># set target path</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">    </span><span class="na">}}d.custom.set</span><span class="o">=</span><span class="s">targetdir,/var/torrent/done/{{label}}/{{relpath}}</span>
</code></pre></div>
<p>Having a minimal configuration with just your changes is recommended, so
you get new defaults in later releases automatically.</p>
<p>See the <a href="https://github.com/pyroscope/pyrocore/blob/master/src/pyrocore/data/config/torque.ini">default
configuration</a>
for <strong>more parameters and what they mean</strong>.</p>
<p>::: warning
::: title
Warning
:::</p>
<p>If the folder tree specified in the <code>path</code> setting overlaps with the
paths used in existing 'watch' schedules of <code>rtorrent.rc</code>, then please
either keep those paths apart, or disable those schedules (comment them
out), <em>before</em> activating tree watch.</p>
<p>Anything else will lead to confusing and inconsistent results.
:::</p>
<h3 id="queue-settings-explained">Queue Settings Explained</h3>
<p>In the above example for the <code>queue</code> job, <code>downloading_max</code> counts
started-but-incomplete items including those that ignore commands. Only
if there are fewer of these items in the client than that number, a new
item will be started. This is the queue's length and thus the most
important parameter.</p>
<p>The queue <em>never</em> stops any items, i.e. <code>downloading_max</code> is not
enforced and you can manually start more items than that if you want to.
That is also the reason items that should be under queue control must be
loaded in 'normal' mode, i.e. stopped.</p>
<p>Other queue parameters are the minimum number of items in
'downloading' state named <code>downloading_min</code>, which trumps
<code>start_at_once</code>, the maximum number of items to start in one run of the
job. Both default to <code>1</code>. Since the default schedule is <code>second=*/15</code>,
that means at most one item would be started every 15 seconds.</p>
<p>But that default is changed using the following two lines:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="na">job.queue.schedule</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s">second=*/5</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="na">job.queue.intermission</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s">60</span>
</code></pre></div>
<p>This makes the queue manager check more often whether there is something
startable, but prevents it from starting the next batch of items when
the last start was less than <code>intermission</code> seconds ago.</p>
<p>The <code>startable</code> condition (repeated below for reference) prevents
ignored items, ones having a non-empty message, and those with the
lowest priority from being started. Note that tree watch sets the
priority of items loaded in 'normal' mode to zero -- that <code>prio&gt;0</code>
condition then excludes them from being started automatically some time
later, until you press <code>+</code> to increase that priority. You can also delay
not-yet-started items using the <code>-</code> key until the item has a priority of
zero (a/k/a <code>off</code>).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="na">job.queue.startable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">is_ignored=0 message= prio&gt;0</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">        </span><span class="k">[ prio&gt;2 OR [ NOT [ traits=audio kind_25=jpg,png,tif,bmp ] ] ]</span>
</code></pre></div>
<p>This sample condition also adds the extra hurdle that audio downloads
that don't stay below a 25% threshold regarding contained images are
<strong>not</strong> started automatically. <em>Unless</em> you raise the priority to 3
(<code>high</code>) using the <code>+</code> key, then they're fair game for the queue. Go do
all that with a plain rTorrent watch dir, in one line of configuration.</p>
<p>The parameter <code>sort_fields</code> is used to determinate in what order
startable items are handled. By default, higher priority items are
started first, and age is used within each priority class.</p>
<p>Above, it was mentioned <code>downloading_max</code> counts started-but-incomplete
items. The exact definition of that classification can be changed using
the <code>downloading</code> condition. A given condition is <em>always</em> extended with
<code>is_active=1 is_complete=0</code>, i.e. the started-but-incomplete
requirement.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="na">job.queue.downloading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[ prio&gt;1 [ down&gt;3 OR started&lt;2i ] ]</span>
</code></pre></div>
<p>In plain English, this example says we only count items that have a
normal or high priority, and transfer data or were started in the last 2
minutes. The priority check means you can 'hide' started items from the
queue by setting them to <code>low</code>, e.g. because they're awfully slow and
prevent your full bandwidth from being used.</p>
<p>The second part automatically ignores stalled items unless just started.
This prevents disk trashing when a big item is still creating its files
and thus has no data transfer -- it looks stalled, but we do not want
yet another item to be started and increasing disk I/O even more, so the
manager sees those idle but young items as occupying a slot in the
queue.</p>
<h3 id="tree-watch-details">Tree Watch Details</h3>
<p>The <code>treewatch</code> job is set to co-operate with the queue as previously
explained, and load items as ready to be started (i.e. in stopped state,
but with normal priority). Any <code>load_mode</code> that is not either <code>start</code> or
<code>started</code> is considered as equivalent to <code>load.normal</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="na">job.treewatch.active</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="na">job.treewatch.load_mode</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">start</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="na">job.treewatch.queued</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
</code></pre></div>
<p>The configuration settings for <code>load_mode</code> and <code>queued</code> can also be
changed on a case-by-case basis. For that, one of the 'flags' <code>load</code>,
<code>start</code>, or <code>queued</code> has to appear in the path of the loaded metafile --
either as a folder name, or else delimited by dots in the file name.
These examples should help with understanding how to use that:</p>
<div class="highlight"><pre><span></span><code>☛ load and start these, ignoring what &#39;load_mode&#39; says
…/tv/start/foo.torrent
…/movies/foo.start.torrent

☛ just load these, ignoring what &#39;load_mode&#39; says
…/tv/load/foo.torrent
…/movies/foo.load.torrent

☛ always queue these, using the configured &#39;load_mode&#39;
…/tv/queue/foo.torrent
…/movies/foo.queue.torrent
</code></pre></div>
<p>Should you have both <code>start</code> and <code>load</code> in a path, then <code>start</code> wins.</p>
<p><code>path</code> determines the root of the folder tree to watch for new metafiles
via registration with the <code>inotify</code> mechanism of Linux. That means they
are loaded milliseconds after they're written to disk, without any
excessive polling.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="na">job.treewatch.path</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s">/var/torrent/watch</span>
</code></pre></div>
<p>You can provide more that one tree to watch, by separating the root
folders with <code>:</code>.</p>
<p>The <code>cmd.«name»</code> settings can be used to provide additional load
commands, executed during loading the new item, <em>before</em> it is started
(in case it is started at all). This is equivalent to the commands you
can append to a rTorrent <code>load.*</code> command. They're added in the
alphabetic order of their names.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="na">job.treewatch.cmd.nfo</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">f.multicall=*.nfo,f.priority.set=2</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="na">job.treewatch.cmd.jpg</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">f.multicall=*.jpg,f.priority.set=2</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="na">job.treewatch.cmd.png</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">f.multicall=*.png,f.priority.set=2</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="na">job.treewatch.cmd.tif</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">f.multicall=*.tif,f.priority.set=0</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="na">job.treewatch.cmd.target</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">{{</span><span class="c1"># set target path</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">    </span><span class="na">}}d.custom.set</span><span class="o">=</span><span class="s">targetdir,/var/torrent/done/{{label}}/{{relpath}}</span>
</code></pre></div>
<p>The above example shows how to set any NFO files and JPG/PNG images to
high priority, and prevent downloading any TIF images by default.</p>
<p>Commands can be templates, see <code>tree-watch</code>{.interpreted-text
role="ref"} for further details on the <code>target</code> command.</p>
<p>::: note
::: title
Note
:::</p>
<p>In case no files are loaded after you activated tree watch, you can set
<code>trace_inotify</code> to <code>True</code> to get detailed logs of all file system events
as they are received.</p>
<p>Also keep in mind that for now, if you add metafiles while the
<code>pyrotorque</code> daemon is not running, you have to <code>touch</code> them manually
after you have restarted it to load them.
:::</p>
<h3 id="testing-your-configuration">Testing Your Configuration</h3>
<p>After having completed your configuration, you're ready to <strong>test it,
by following these steps</strong>:</p>
<ol>
<li>Execute <code>rm ~/.pyroscope/run/pyrotorque</code> to <strong>prevent the watchdog
    from starting the manager</strong> in the background.</li>
<li><strong>Stop any running daemon</strong> process using <code>pyrotorque --stop</code>, just
    in case.</li>
<li>Run <code>pyrotorque --fg -v</code> in a terminal, this will <strong>start the job
    scheduler in the foreground</strong> with verbose logging directly to that
    terminal, exactly what you need to check out if your configuration
    does what you intended. It also helps you to understand what goes on
    \"under the hood\".</li>
<li>If you applied <strong>changes to your configuration</strong>, stop the running
    scheduler by pressing CTRL-C, then <strong>restart it</strong>. Wash, rinse,
    repeat.</li>
<li>Press CTRL-C for the last time and call <code>pyrotorque --status</code>, it
    should show that no daemon process is running.</li>
<li>Execute <code>touch ~/.pyroscope/run/pyrotorque</code> --- this does <strong>create
    the guard file again</strong>, which must always exist if you want
    <code>pyrotorque</code> to run in the background (otherwise you'll just get an
    error message on the console or in the log, if you try to launch
    it).</li>
<li><strong>Wait up to 300 seconds</strong>, and if your <em>rTorrent</em> configuration has
    the <code>pyro_watchdog</code> schedule as it should have,
    <code>pyrotorque --status</code> will show that a daemon process was
    automatically started by that <em>rTorrent</em> schedule.</li>
<li>Enjoy, and <strong>check</strong> <code>~/.pyroscope/log/torque.log</code> for feedback from
    the daemon process.</li>
</ol>
<p>If you want to restart the daemon running in the background immediately,
e.g. to <strong>reload</strong> <code>torque.ini</code> or after a software update, use
<code>pyrotorque --cron --restart</code>.</p>
<h2 id="built-in-jobs">Built-in Jobs</h2>
<p>The <code>QueueManager</code> is just one kind of job that can be run by
<code>pyrotorque</code>. It has an embedded scheduler that can run any number of
additional jobs, the following sections explain the built-in ones. Since
these jobs can be loaded from any available Python package, you can also
easily <code>write your own &lt;torque-custom-jobs&gt;</code>{.interpreted-text
role="ref"}.</p>
<p>Jobs and their configuration are added in the <code>[TORQUE]</code> section, by
providing at least the parameters <code>job.«NAME».handler</code> and
<code>job.«NAME».schedule</code>. Depending on the handler, additional parameters
can/must be provided (see below for a list of built-in handlers and what
they do).</p>
<p>Details on the <code>schedule</code> parameter can be found
<a href="https://apscheduler.readthedocs.io/en/3.x/modules/triggers/cron.html">here</a>.
Multiple fields must be separated by spaces, so if a field value
contains a space, it must be quoted, e.g. <code>hour=12 "day=3rd sun"</code>. The
<code>handler</code> parameter tells the system where to look for the job
implementation, see the handler descriptions below for the correct
values.</p>
<p><strong>QueueManager</strong></p>
<p><code>pyrocore.torrent.queue:QueueManager</code> manages queued downloads (i.e.
starts them in a controlled manner), it is described in detail
<code>further up on this page &lt;torque-config&gt;</code>{.interpreted-text role="ref"}.</p>
<p><strong>TreeWatch</strong> (beta, not feature-complete)</p>
<p><code>pyrocore.torrent.watch:TreeWatch</code> watches a folder tree, which can be
nested arbitrarily. Loading of new <code>.torrent</code> files is immediate (using
<code>libnotify</code>).</p>
<p><strong>TODO</strong> Each sub-directory can contain a <code>watch.ini</code> configuration file
for parameters like whether to start new items immediately, and for
overriding the completion path.</p>
<p>See the explanation of the example configuration above and
<code>tree-watch</code>{.interpreted-text role="ref"} for further details.</p>
<p><strong>EngineStats</strong></p>
<p><code>pyrocore.torrent.jobs:EngineStats</code> runs once per minute, checks the
connection to rTorrent, and logs some statistical information.</p>
<p>You can change it to run only hourly by adding this to the
configuration: <code>job.connstats.schedule      = hour=*</code></p>
<h1 id="using-the-tree-watch-job">Using the Tree Watch Job</h1>
<h2 id="introduction_1">Introduction</h2>
<p>As mentioned in <code>QueueManager</code>{.interpreted-text role="ref"}, commands
configured to be executed during item loading can be templates. This can
be used to support all sorts of tricks, the most common ones are
explained here, including fully dynamic completion moving. If the
following explanation of the inner workings is too technical and nerdy
for you, skip to the <code>tree-watch-examples</code>{.interpreted-text role="ref"}
section below, and just adapt one of the prepared use cases to your
setup.</p>
<p>So how does this work? When a <code>.torrent</code> file is notified for loading
via <code>inotify</code>, it's parsed and contained data is put into variables
that can be used in the command templates. In order to get an idea what
variables are available, you can dump the templating namespace for a
metafile to the console, by calling the <code>watch</code> job directly.</p>
<p>Consider this example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>$<span class="w"> </span>date<span class="w"> </span>&gt;example.dat
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>$<span class="w"> </span>mktor<span class="w"> </span>-q<span class="w"> </span>example.dat<span class="w"> </span>http://tracker.example.com/
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>$<span class="w"> </span>python-pyrocore<span class="w"> </span>-m<span class="w"> </span>pyrocore.torrent.watch<span class="w"> </span>-v<span class="w"> </span>example.dat.torrent
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>…
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>DEBUG<span class="w">    </span>Tree<span class="w"> </span>watcher<span class="w"> </span>created<span class="w"> </span>with<span class="w"> </span>config<span class="w"> </span>Bunch<span class="o">(</span><span class="nv">active</span><span class="o">=</span>False,<span class="w"> </span>…
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">    </span>cmd.target<span class="o">=</span><span class="s1">&#39;{{# set target path\n}}d.custom.set=targetdir,/var/torrent/done/{{label}}/{{relpath}}&#39;</span>,
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">    </span><span class="nv">dry_run</span><span class="o">=</span>True,<span class="w"> </span><span class="nv">handler</span><span class="o">=</span><span class="s1">&#39;pyrocore.torrent.watch:TreeWatch&#39;</span>,<span class="w"> </span><span class="nv">job_name</span><span class="o">=</span><span class="s1">&#39;treewatch&#39;</span>,
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">    </span><span class="nv">load_mode</span><span class="o">=</span><span class="s1">&#39;start&#39;</span>,<span class="w"> </span><span class="nv">path</span><span class="o">=</span><span class="s1">&#39;/var/torrent&#39;</span>,<span class="w"> </span><span class="nv">queued</span><span class="o">=</span><span class="s1">&#39;True&#39;</span>,<span class="w"> </span><span class="nv">quiet</span><span class="o">=</span><span class="s1">&#39;False&#39;</span>,<span class="w"> </span><span class="nv">schedule</span><span class="o">=</span><span class="s1">&#39;hour=*&#39;</span><span class="o">)</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>DEBUG<span class="w">    </span>custom<span class="w"> </span><span class="nv">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="s1">&#39;target&#39;</span>:<span class="w"> </span>&lt;Template<span class="w"> </span>2d01990<span class="w"> </span><span class="nv">name</span><span class="o">=</span>None&gt;,<span class="w"> </span><span class="s1">&#39;nfo&#39;</span>:<span class="w"> </span>f.multicall<span class="o">=</span>*.nfo,f.set_priority<span class="o">=</span><span class="m">2</span>,<span class="w"> </span>…<span class="o">}</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>INFO<span class="w">     </span>Templating<span class="w"> </span>values<span class="w"> </span>are:
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">    </span><span class="nv">commands</span><span class="o">=[</span>…,<span class="w"> </span><span class="s1">&#39;d.custom.set=targetdir,/var/torrent/done//pyrocore&#39;</span>,<span class="w"> </span>…<span class="o">]</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">    </span><span class="nv">filetype</span><span class="o">=</span><span class="s1">&#39;.dat&#39;</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">    </span>…
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">    </span><span class="nv">info_hash</span><span class="o">=</span><span class="s1">&#39;8D59E3FD8E78CC9896BDE4D65B0DC9BDBA0ADC70&#39;</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">    </span><span class="nv">info_name</span><span class="o">=</span><span class="s1">&#39;example.dat&#39;</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">    </span><span class="nv">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">    </span><span class="nv">pathname</span><span class="o">=</span><span class="s1">&#39;/var/torrent/pyroscope/example.dat.torrent&#39;</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="w">    </span><span class="nv">relpath</span><span class="o">=</span><span class="s1">&#39;pyrocore&#39;</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">    </span><span class="nv">tracker_alias</span><span class="o">=</span><span class="s1">&#39;tracker.example.com&#39;</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="w">    </span><span class="nv">traits</span><span class="o">=</span>Bunch<span class="o">(</span><span class="nv">kind</span><span class="o">=</span>None<span class="o">)</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="w">    </span><span class="nv">watch_path</span><span class="o">=</span>set<span class="o">([</span><span class="s1">&#39;/var/torrent&#39;</span><span class="o">])</span>
</code></pre></div>
<p>Things to take note of:</p>
<ol>
<li>
<p>the <code>target</code> custom command is expanded to set the <code>targetdir</code>
    rTorrent attribute to the completion path (which can then be used in
    a typical <code>event.download.finished</code> handler), using the <code>relpath</code>
    variable which is obtained from the full <code>.torrent</code> path, relative
    to the watch dir root.</p>
</li>
<li>
<p>all kinds of other information is made available, like the
    torrent's info hash and the tracker alias; thus you can write
    conditional templates based on tracker, or use the tracker name in a
    completion path.</p>
</li>
<li>
<p>for certain types of downloads, <code>traits</code> provides parsed information
    to build specific target paths, e.g. for the
    <code>Pioneer.One.S01E06.720p.x264-VODO</code> TV episode, you'll get this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="na">label</span><span class="o">=</span><span class="s">&#39;tv/mkv&#39;</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="na">traits</span><span class="o">=</span><span class="s">Bunch(aspect=None, codec=&#39;x264&#39;, episode=&#39;06&#39;, extension=None, format=&#39;720p&#39;,</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="na">group</span><span class="o">=</span><span class="s">&#39;VODO&#39;, kind=&#39;tv&#39;, pattern=&#39;Normal TV Episodes&#39;, release=None,</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">    </span><span class="na">release_tags</span><span class="o">=</span><span class="s">None, season=&#39;01&#39;, show=&#39;Pioneer.One&#39;, sound=None, title=None)</span>
</code></pre></div>
</li>
</ol>
<h2 id="tree-watch-examples">Tree Watch Examples</h2>
<p>::: {.contents local=""}
:::</p>
<h3 id="completion-moving">Completion Moving</h3>
<p>Since the templating namespace automatically includes the path of a
loaded <code>.torrent</code> file relative to the watch root (in <code>relpath</code>, see
above example namespace output and the config example further down), you
can set the \"move on completion\" target using that value.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="na">job.treewatch.cmd.target</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">{{</span><span class="c1"># set target path</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="na">}}d.custom.set</span><span class="o">=</span><span class="s">targetdir,/var/torrent/done/{{label}}/{{relpath}}</span>
</code></pre></div>
<p>Note that this still needs a typical completion event handler that takes
the custom variable that is set, and moves the data based on its value.</p>
<h3 id="tree-watch-with-sorting">Tree Watch with Sorting</h3>
<p>This example adds a <em>second</em> job for a <code>sorted</code> tree that directly saves
the data into a path based on the loaded metafile's location.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Tree watch with location</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="na">job.watch-sorted.handler</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">pyrocore.torrent.watch:TreeWatch</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="na">job.watch-sorted.schedule</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">hour=*</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="na">job.watch-sorted.active</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="na">job.watch-sorted.load_mode</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s">normal</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="na">job.watch-sorted.queued</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="na">job.watch-sorted.path</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s">/var/torrent/sorted/watch</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="na">job.watch-sorted.cmd.setdir</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">{{</span><span class="c1"># set download path</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">    </span><span class="na">}}{{if &#39;/music/&#39; in pathname}}{{# add metafile basename to path</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">        </span><span class="na">}}d.directory_base.set</span><span class="o">=</span><span class="s">&quot;/var/torrent/sorted/{{relpath}}/{{pathname|h.pathname}}&quot;{{</span><span class="c1">#</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w">    </span><span class="na">}}{{elif traits.kind</span><span class="w"> </span><span class="o">=</span><span class="s">= &#39;tv&#39;}}{{</span><span class="c1"># store TV content into separate show folders</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">        </span><span class="na">}}d.directory.set</span><span class="o">=</span><span class="s">&quot;/var/torrent/sorted/{{relpath}}/{{traits.get(&#39;show&#39;, &#39;_UNKNOWN&#39;).replace(&#39;.&#39;,&#39; &#39;).title()}}&quot;{{</span><span class="c1">#</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">    </span><span class="na">}}{{else}}{{# just use the relative metafile location</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">        </span><span class="na">}}d.directory.set</span><span class="o">=</span><span class="s">&quot;/var/torrent/sorted/{{relpath}}&quot;{{</span><span class="c1">#</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">    </span><span class="na">}}{{endif}}</span>
</code></pre></div>
<p>Change the values in the second block to suit your needs. As given, an
item loaded from <code>…/sorted/watch/movies/*.torrent</code> would end up in the
<code>…/sorted/movies</code> directory (with the filename coming from inside the
metafile as usual), and it won't start by itself.</p>
<p>Also, paths containing <code>music</code> use the metafile's basename as the data
directory, and metafiles recognized as TV content get separated into
show directories.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "toc.integrate"], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.4b2c34cd.min.js"></script>
      
    
  </body>
</html>